<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex">
    <title>Document</title>
</head>
<body>
    <div class="container">
        <div class="alert alert-success" id="succes" role="alert">
            <strong>Виконано!</strong>
        </div>
        <h1>Панель Управління</h1>
        <hr>
        <div class="row">
            <div class="col-lg-2">
                <ul class="nav nav-pills flex-column" id="myTab" role="tablist">
                    <li class="nav-item">
                        <a class="nav-link active" id="car-list-tab" data-toggle="tab" href="#car-list" role="tab" aria-controls="car-list" aria-selected="true">Список авто</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="add-car-tab" data-toggle="tab" href="#add-car" role="tab" aria-controls="add-car" aria-selected="false">Додати авто</a>
                    </li>
                </ul>
            </div>
            <div class="col-lg-10">
                <div class="tab-content" id="myTabContent">
                    <div class="tab-pane fade show active" id="car-list" role="tabpanel" aria-labelledby="home-tab">
                        <h2 class="ht">Активні оголошення</h2>
                        <ol id="list-car">
        </ol>
    </div>
    <div class="tab-pane fl fade" id="add-car" role="tabpanel" aria-labelledby="profile-tab">
        <h2 class="ht">Додати нове оголошення</h2>
        <div>
           <p class="param">Рік випуску</p>
           <select id="yr" class="sel">
               <option class="opt" disabled selected hidden>Рік</option>
               <option class="opt">2020</option>
               <option class="opt">2019</option>
               <option class="opt">2018</option>
               <option class="opt">2017</option>
               <option class="opt">2016</option>
               <option class="opt">2015</option>
               <option class="opt">2014</option>
               <option class="opt">2013</option>
               <option class="opt">2012</option>
               <option class="opt">2011</option>
               <option class="opt">2010</option>
               <option class="opt">2009</option>
               <option class="opt">2009</option>
               <option class="opt">2008</option>
               <option class="opt">2007</option>
               <option class="opt">2006</option>
               <option class="opt">2005</option>
               <option class="opt">2004</option>
               <option class="opt">2003</option>
               <option class="opt">2002</option>
               <option class="opt">2001</option>
               <option class="opt">2000</option>
              </select>
        </div>
        <div>
            <p class="param">Паливо</p>
            <select id="fl" class="sel">
                <option class="opt" disabled selected hidden>Паливо</option>
                <option class="opt">Бензин</option>
                <option class="opt">Дизель</option>
                <option class="opt">Електро</option>
                <option class="opt">Гібрид</option>
            </select>
        </div>
        <div>
            <p  class="param">Коробка</p>
            <select id="tm" class="sel">
                <option class="opt" disabled selected hidden>Коробка</option>
             <option class="opt">Автомат</option>
             <option class="opt">Механіка</option>
            </select>
        </div>
        <div>
            <p class="param">Марка</p>
            <select id="mark" class="sel">
                <option class="opt" disabled selected hidden>Марка</option>
	            <option class="opt">Audi</option>
                <option class="opt">BMW</option>
                <option class="opt">Chevrolet</option>
                <option class="opt">Citroen</option>
                <option class="opt">Ford</option>
                <option class="opt">Fiat</option>
                <option class="opt">Honda</option>
                <option class="opt">Hyundai</option>
                <option class="opt">Jaguar</option>
                <option class="opt">Kia</option>
                <option class="opt">Land Rover</option>
	            <option class="opt">Lexus</option>
                <option class="opt"">Mazda</option>
                <option class="opt">Mercedes</option>
                <option class="opt"">Mitsubishi</option>
                <option class="opt">Nissan</option>
                <option class="opt">Opel</option>
                <option class="opt">Peugeot</option>
                <option class="opt">Porsche</option>
                <option class="opt">Renault</option>
                <option class="opt">Seat</option>
	            <option class="opt">Skoda</option>
	            <option class="opt"">Subaru</option>
                <option class="opt"">Suzuki</option>
                <option class="opt">Tesla</option>
	            <option class="opt"">Toyota</option>
                <option class="opt"">Volkswagen</option>
                <option class="opt">Volvo</option>
            </select>
           </div>
        <div>
            <p class="param">Потужність кВт.</p>
            <input id="kwt" type="number" min="50" class="sel">
        </div>
        <div>
            <p class="param">Ціна $.</p>
            <input required id="pc" type="number" min="3000" class="sel">
        </div>
        <div>
            <p class="param">Пробіг км.</p>
            <input required id="km" type="number" min="10000" class="sel">
        </div>
        <div>
            <p class="param">Модель</p>
            <input id="model" class="sel">
        </div>
        <div>
            <p class="param">Ссилка на auto ria</p>
            <input id="url" class="sel">
        </div>
        <input type='file' id="ph"  style="display:none"/>
        <button onclick="document.getElementById('ph').click()" class="all-cars load-else ml">Додати фото  <i class="fa fa-picture-o" aria-hidden="true"></i></button>
        <img class="car-img ci" id="pr" src="https://upload.wikimedia.org/wikipedia/commons/8/83/Tesla_Model_3_parked%2C_front_driver_side.jpg" alt="car">
        <a href="contact.html" type="button" id="add" class="send-msg ">Додати</a>
    </div>
      </div>
    </div>
        </div>
    </div> 
</div>

<script src="../js/jquery-3.5.1.min.js"></script>
<script>
 $('#succes').hide();

 $(function(){
	$(document).on("click",".car-img",function() {
	  var i_path = $(this).attr('src');
	  console.log(i_path);
	  console.log(this);
	  $('body').append('<div id="overlay"></div><div id="magnify"><img src="'+i_path+'"><div id="close-popup"><i></i></div></div>');
	  $('#magnify').css({
		  left: ($(document).width() - $('#magnify').outerWidth())/2,
		  // top: ($(document).height() - $('#magnify').outerHeight())/2 upd: 24.10.2016
			  top: ($(window).height() - $('#magnify').outerHeight())/2
		});
	  $('#overlay, #magnify').fadeIn('fast');
	});
	
	$('body').on('click', '#close-popup, #overlay', function(event) {
	  event.preventDefault();
   
	  $('#overlay, #magnify').fadeOut('fast', function() {
		$('#close-popup, #magnify, #overlay').remove();
	  });
	});
  });

  $('.max-km').on('input', function () {
	$(".max-km-view").text("Макс. пробіг: "+e.value);
});

var token =localStorage.getItem("accessToken");
var fileTag = document.getElementById("ph"),
    preview = document.getElementById("pr");
var img;
fileTag.addEventListener("change", function() {
  changeImage(this);
});

function changeImage(input) {
  var reader;

  if (input.files && input.files[0]) {
    reader = new FileReader();

    reader.onload = function(e) {
      preview.setAttribute('src', e.target.result);
      img=e.target.result.split(',')[1];
    }

    reader.readAsDataURL(input.files[0]);
  }
}
window.onload = function(){  
 $.ajax({
            url: "https://localhost:44369/Auth/GetCars",
            type: "GET",
           crossDomain: true,
            headers: {"Authorization": 'Bearer ' + token,'Access-Control-Allow-Origin': '*',"Accept": "application/json",},
            success: function (response) {
                show(response);
            }
 });
 function show(cars) {  
var ol=document.getElementById("list-car");
cars.forEach(element => {
   $('#list-car').append(
               `<div id="${element.id}" class="car-list-item">
                <img class="car-img ci" src="data:image/png;base64,${element.picture}">
                <p>${element.mark}</p>
                <p>${element.model}</p>
                <p>${element.year}</p>
                <p>${element.price}$</p>
                <a type="button" class="closer" onClick="del(this)"><i class="fa fa-window-close fa-2x" aria-hidden="true"></i></a>       
                </div>`);});
 }
}

function del(el) {
    var id = el.parentNode.id;
    $.ajax({
            url: "https://localhost:44369/Auth/DelCar",
            type: "POST",
           crossDomain: true,
            headers: {"Authorization": 'Bearer ' + token,'Access-Control-Allow-Origin': '*',"Accept": "application/json",},
            data:  { num: id},
            success: function (response) {
                $('#succes').show();
                setTimeout(function(){
                    $('#succes').hide();
}, 5000);
            }
        });
    $("#"+el.parentNode.id).remove();
 }

 document.getElementById("add").addEventListener("click", e => {

e.preventDefault();
var car = {"Mark":document.getElementById("mark").value,"Model":document.getElementById("model").value,"Fuel":document.getElementById("fl").value,"Transmission":document.getElementById("tm").value,"Year":document.getElementById("yr").value,"Price":document.getElementById("pc").value,"Power":document.getElementById("kwt").value,"Km":document.getElementById("km").value,"Picture":img,"Url":document.getElementById("url").value};
 $.ajax({
            url: "https://localhost:44369/Auth/AddCar",
            type: "POST",
           crossDomain: true,
            headers: {"Authorization": 'Bearer ' + token,'Access-Control-Allow-Origin': '*',"Accept": "application/json",},
            data: car,
            success: function (response) {
                $('#succes').show();
                setTimeout(function(){
                    $('#succes').hide();
}, 5000);
            }
        });
});
</script>
<link rel="stylesheet" href="../css/bootstrap.min.css">
<link rel="stylesheet" href="../css/font-awesome.min.css">
<link rel="stylesheet" href="../css/style.css">
<script src="../js/bootstrap.min.js"></script>
</body>
</html>